var http = require('http');
var querystring = require('querystring');
var url = require('url');

const PORT = 8080;
const REGISTER = '/register';

var id_counter = 0;

function Pod(id, ip, sensors) {
    this.id = id;
    this.ip = ip;
    this.sensors = sensors;
}

http.createServer(function(request, response {
    switch(url.parse(request.url).pathname) {
    case REGISTER:
	if (request.method == "POST") {
	    var body = '';
	    request.on('data', function(data) {
		body += data.toString();
	    });
	    
	    request.on('end', function() {
		var pod = new Pod(id_counter++, request.connection.remoteAddress, body)
		console.log(body);
		console.log(typeof body);
		
		response.writeHead(200, "OK", {'Content-Type': 'text/html'});
		response.end();
	    });
	    
	}
	break;
	
    default:
	break;
    }
}).listen(PORT);
